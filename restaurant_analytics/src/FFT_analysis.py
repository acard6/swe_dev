import numpy as np
from scipy.signal import detrend
import matplotlib.pyplot as plt

# x = np.array(   [44, 73, 164, 186, 164, 148, 133, 184, 157, 133, 118, 
#                 140, 157, 133, 180, 194, 184, 207, 208, 164, 161, 232, 
#                 199, 168, 177, 231, 231, 158, 255, 164, 201, 163, 208, 
#                 199, 189, 174, 179, 207, 203, 189, 154, 147, 200, 173, 
#                 196, 174, 157, 197, 202, 168, 186, 180, 186, 143, 101,
#                 146, 154, 157])

# first 12 points   53, 44, 37, 19, 34, 48, 37, 49, 73, 21, 43, 41, 
x = np.array([46, 66, 125, 164, 42, 48, 69, 39, 
              96, 158, 186, 64, 58, 117, 94, 49, 134, 164, 48, 32, 48, 66, 37, 138, 148, 56, 43, 
              64, 44, 86, 148, 133, 84, 31, 53, 38, 104, 169, 184, 143, 57, 57, 77, 78, 160, 157, 
              70, 68, 40, 78, 65, 151, 133, 82, 63,38, 76, 73, 169, 118, 40, 67, 80, 72, 51, 168, 
              140, 76, 74, 70, 77, 75, 128, 157, 97, 93, 51, 56, 94, 200, 133, 82, 54, 38, 85, 
              78, 176, 180, 69, 81, 58, 112, 88, 151, 194, 54, 85, 47, 71, 135, 167, 184, 65, 73, 
              86, 10, 87, 190, 207, 69, 63, 107, 101, 154, 181, 208, 92, 72, 85, 62, 99, 200, 164, 
              115, 61, 79, 106, 80, 150, 161, 60, 67, 73, 74, 103, 159, 232, 74, 65, 41, 61, 117, 
              124, 199, 55, 44, 62, 48, 154, 256, 168, 40, 0, 54, 73, 76, 163, 177, 58, 84, 61, 
              92, 140, 178, 231, 47, 84, 112, 104, 82, 181, 231, 64, 59, 53, 116, 84, 135, 158, 
              63, 84 , 39 , 65 , 39, 219, 255, 78, 30, 31, 71, 95, 210, 164, 69, 40, 42, 69, 89, 
              170, 201, 69, 37, 80, 54, 45, 106, 163, 53, 21, 47, 46, 18, 167, 208, 32, 48, 37, 
              88, 79, 150, 199, 94, 50, 58, 137, 82, 134, 189, 58, 53, 34, 60, 69, 170, 174, 63, 
              48, 50, 82, 78, 100, 179, 55, 61, 58, 78, 90, 125, 207, 90, 58, 118, 92, 58, 160, 
              203, 78, 22, 67, 119, 135, 149, 189, 98, 118, 144, 0, 52, 155, 154, 62, 77, 186, 50, 
              57, 137, 147, 26, 38, 46, 49, 53, 73, 200, 38, 16, 45, 52, 38, 176, 173, 73, 0, 19, 
              57, 45, 165, 196, 44, 52, 48, 33, 74, 142, 174, 61, 36, 45, 49, 36, 106, 157, 0, 52, 
              36, 29, 65, 265, 197, 97, 42, 36, 57, 32, 167, 202, 23, 28, 52, 44, 77, 152, 168, 39, 
              44, 43, 56, 47, 86, 186, 37, 50, 98, 39, 45, 116, 180, 110, 4, 33, 57, 108, 104, 186, 
              46, 38, 75, 34, 35, 118, 143, 48, 56, 46, 44, 35, 82, 101, 38, 38, 81, 22, 62, 112])

N = len(x)

trend = np.polyfit(np.arange(N), x, deg=1)
trendline = np.polyval(trend, np.arange(N))

mean_val = np.mean(x)
x_detrend = detrend(x)
# x_detrend = x - trendline


X = np.fft.fft(x)
freqs = np.fft.fftfreq(N, d=1)
amps = np.abs(X)

dom_freq = freqs[np.argsort(amps)[-1:]]

# print(dom_freq)
# plt.figure()
# plt.stem(freqs[:N//2], amps[:N//2])
# plt.xlabel("frequencies")
# plt.ylabel("amps")
# plt.show()

k = 10   # reconstruct using top k freqs
idx = np.argsort(amps[1:N//2])[-k:] + 1
filter_X = np.zeros_like(X)#
filter_X[idx] = X[idx]
filter_X[-idx] = X[-idx]

his_head_just_did_that =np.fft.ifft(filter_X).real


def synthesize_signal(t_range, X, freqs, indices, N):
    result = np.zeros_like(t_range, dtype=float)
    for k in indices:
        A = np.abs(X[k]) / N
        phase = np.angle(X[k])
        f = freqs[k]
        result += A * np.cos(2 * np.pi * f * t_range + phase)
    return result

# Predict next 12 points
t_future = np.arange(N, N + 21)
predicted = synthesize_signal(t_future, X, freqs, idx, N)
predicted += mean_val
for i in predicted:
    print(round(i))
# def main():
#     pass

# if __name__ == "__main__":
#     main()

"""
4/12/2025: 115      
4/13/2025: 103  
4/14/2025: 121, 72  
4/15/2025: 123, 73  
4/16/2025: 123, 64  
4/17/2025: 122, 74  
4/18/2025: 120, 83       
4/19/2025: 118, 109      
4/20/2025: 118, 90  
4/21/2025: 120, 71  
4/22/2025: 124, 67  
4/23/2025: 128, 58  
4/24/2025: 131, 70  
4/25/2025: 130, 84       
4/26/2025: 126, 115     
4/27/2025: 122, 97 
4/28/2025: 118, 73  
4/29/2025: 117, 68  
4/30/2025: 118, 64  
5/01/2025: 121, 80  
5/02/2025: 124, 94 
        chatGPT    
"""
